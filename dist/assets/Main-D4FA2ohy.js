import{d as $,o as F,a as N,b as o,c as i,e as t,n as v,t as n,f as y,F as k,r as A,g as p,h as x,_ as O,i as V}from"./index-DcFP4OhZ.js";const w="http://localhost:8000";async function S(r){const l=await fetch(`${w}${r}`);if(!l.ok)throw new Error(`API error ${l.status}`);return await l.json()}async function q(){return S("/api/arbitrage/status")}async function I(r=100){return(await S(`/api/arbitrage/opportunities?limit=${r}`)).items}async function j(r=50){return(await S(`/api/arbitrage/trades?limit=${r}`)).items}function U(r){const l=w.replace(/^http/,"ws"),u=new WebSocket(`${l}/ws/arbitrage`);return u.addEventListener("message",d=>{try{const c=JSON.parse(d.data);c.type==="arbitrage_snapshot"&&r({snapshot:c.snapshot,spread_series:c.spread_series??[]})}catch{}}),u}const z={class:"main-page"},J={class:"panel"},M={class:"panel-header"},T={key:0,class:"error-box"},W={class:"metrics"},R={class:"metric"},G={class:"metric"},H={class:"metric"},K={class:"metric"},Q={class:"metric"},X={class:"metric"},Y={class:"table-wrap"},Z={key:0},tt={key:1},et={class:"trades-section"},at={key:0},st=$({__name:"ArbitrageSimulationPanel",setup(r){const l=p(!0),u=p(""),d=p(null),c=p([]),h=p([]),_=p("disconnected");let g=null;const m=x(()=>c.value.filter(s=>s.status==="accepted")),L=x(()=>m.value.length?m.value.reduce((e,a)=>e+a.net_spread_pct,0)/m.value.length:0),B=x(()=>{const s=d.value?.latest_opportunity?.latency_ms??0;return s>900?"Alta":s>450?"Média":"Baixa"});function b(s){return`${s>=0?"+":""}${s.toFixed(2)}%`}function f(s){return`${s>=0?"+":""}$${s.toFixed(2)}`}function E(s){return s>900?"alta":s>450?"media":"baixa"}function P(s){return s>900?"Alta":s>450?"Média":"Baixa"}async function C(){try{u.value="";const[s,e,a]=await Promise.all([q(),I(50),j(20)]);d.value=s,c.value=e,h.value=a}catch{u.value="Não foi possível carregar os dados do backend. Verifica se o FastAPI está ativo na porta 8000."}finally{l.value=!1}}function D(){g=U(({snapshot:s})=>{d.value=s,_.value="connected"}),g.addEventListener("close",()=>{_.value="disconnected"}),g.addEventListener("error",()=>{_.value="disconnected"})}return F(async()=>{await C(),D()}),N(()=>{g?.close()}),(s,e)=>(o(),i("section",z,[t("div",J,[t("div",M,[e[0]||(e[0]=t("h2",null,"Simulador de Captura de Arbitragem",-1)),e[1]||(e[1]=t("p",null," Objetivo: detectar ineficiências entre order books e simular captura de lucro líquido automatizada, considerando volatilidade em tempo real. ",-1)),t("p",{class:v(["connection",_.value])},"WS: "+n(_.value),3)]),u.value?(o(),i("p",T,n(u.value),1)):y("",!0),t("div",W,[t("div",R,[e[2]||(e[2]=t("span",null,"Oportunidades ativas",-1)),t("strong",null,n(m.value.length),1)]),t("div",G,[e[3]||(e[3]=t("span",null,"Lucro líquido médio",-1)),t("strong",null,n(b(L.value)),1)]),t("div",H,[e[4]||(e[4]=t("span",null,"Risco de volatilidade",-1)),t("strong",null,n(B.value),1)]),t("div",K,[e[5]||(e[5]=t("span",null,"P&L acumulado",-1)),t("strong",null,n(f(d.value?.total_pnl_usd??0)),1)]),t("div",Q,[e[6]||(e[6]=t("span",null,"Saldo simulado",-1)),t("strong",null,n(f(d.value?.balance_usd??0)),1)]),t("div",X,[e[7]||(e[7]=t("span",null,"Exchanges ativas",-1)),t("strong",null,n(d.value?.active_exchanges?.join(", ")||"-"),1)])]),t("div",Y,[t("table",null,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Par"),t("th",null,"Compra (A)"),t("th",null,"Venda (B)"),t("th",null,"Spread Bruto"),t("th",null,"Lucro Líquido"),t("th",null,"Lucro Esperado (USD)"),t("th",null,"Latência (ms)"),t("th",null,"Volatilidade"),t("th",null,"Status")])],-1)),t("tbody",null,[l.value?(o(),i("tr",Z,[...e[8]||(e[8]=[t("td",{colspan:"9"},"A carregar dados...",-1)])])):c.value.length?y("",!0):(o(),i("tr",tt,[...e[9]||(e[9]=[t("td",{colspan:"9"},"Sem oportunidades recebidas.",-1)])])),(o(!0),i(k,null,A(c.value,a=>(o(),i("tr",{key:`${a.timestamp}-${a.buy_exchange}-${a.sell_exchange}`},[t("td",null,n(a.symbol),1),t("td",null,n(a.buy_exchange),1),t("td",null,n(a.sell_exchange),1),t("td",{class:v(a.gross_spread_pct>=0?"positive":"negative")},n(b(a.gross_spread_pct)),3),t("td",{class:v(a.net_spread_pct>=0?"positive":"negative")},n(b(a.net_spread_pct)),3),t("td",{class:v(a.expected_profit_usd>=0?"positive":"negative")},n(f(a.expected_profit_usd)),3),t("td",null,n(a.latency_ms.toFixed(1)),1),t("td",null,[t("span",{class:v(["badge",E(a.latency_ms)])},n(P(a.latency_ms)),3)]),t("td",null,n(a.status),1)]))),128))])])]),t("div",et,[e[11]||(e[11]=t("h3",null,"Execuções Simuladas",-1)),t("ul",null,[(o(!0),i(k,null,A(h.value.slice().reverse().slice(0,5),a=>(o(),i("li",{key:a.timestamp+a.buy_exchange+a.sell_exchange},n(a.symbol)+" | "+n(a.buy_exchange)+" → "+n(a.sell_exchange)+" | "+n(f(a.pnl_usd)),1))),128)),h.value.length?y("",!0):(o(),i("li",at,"Ainda não há execuções simuladas."))])])])]))}}),nt=O(st,[["__scopeId","data-v-02351cfe"]]),ot=$({__name:"Main",setup(r){return(l,u)=>(o(),V(nt))}});export{ot as default};
